<app-nav-belt></app-nav-belt>
<app-nav-categories></app-nav-categories>

<div class="cart-page">
  <!-- Contenedor principal del carrito -->
  <div class="cart-container">
    <h1>Carrito de Compras</h1>

    <!-- Lista de Carrito (Productos No Pagados) -->
    <h2>Productos en el Carrito</h2>
    @if (cartItems.length > 0) {
      <table>
        <tbody>
          @for (item of cartItems; track $index) {
            <tr>
              <!-- Columna 1: Informaci√≥n del Producto -->
              <td class="product-info">
                <div class="product-details">
                  <div class="product-title">{{ item.productDetails?.nombre || 'Sin t√≠tulo' }}</div>
                  <div class="product-price">{{ item.price }} ‚Ç¨</div>
                </div>
              </td>

              <!-- Columna 2: Cantidad -->
              <td class="quantity-controls">
                <button class="quantity-button" (click)="increaseQuantity(item.id)">+</button>
                <input
                  type="number"
                  min="1"
                  [value]="item.quantity"
                  (input)="updateQuantity(item.id, $event)"
                  class="quantity-input"
                />
                <button class="quantity-button" (click)="decreaseQuantity(item.id)">-</button>
              </td>

              <!-- Columna 3: Total -->
              <td>{{ item.price * item.quantity }} ‚Ç¨</td>

              <!-- Columna 4: Acciones -->
              <td class="product-actions">
                <button class="delete-button-top" (click)="removeItem(item.id)">
                  <span class="trash-icon">üóëÔ∏è</span>
                </button>

                <!-- Barra de Progreso -->
                <div class="progress-container">
                  <div class="progress-bar">
                    <div
                      class="progress-fill"
                      [style.width]="
                        item.status === 'No pagado'
                          ? '0%'
                          : item.status === 'Pagado'
                          ? '33%'
                          : item.status === 'Enviado'
                          ? '66%'
                          : '100%'
                      "
                    ></div>
                  </div>

                  <!-- Checkpoints -->
                  <div class="progress-checkpoints">
                    <div
                      class="checkpoint"
                      [class.active]="
                        item.status === 'No pagado' ||
                        item.status === 'Pagado' ||
                        item.status === 'Enviado' ||
                        item.status === 'Recibido'
                      "
                    >
                      No Pagado
                    </div>
                    <div
                      class="checkpoint"
                      [class.active]="
                        item.status === 'Pagado' ||
                        item.status === 'Enviado' ||
                        item.status === 'Recibido'
                      "
                    >
                      Pagado
                    </div>
                    <div
                      class="checkpoint"
                      [class.active]="item.status === 'Enviado' || item.status === 'Recibido'"
                    >
                      Enviado
                    </div>
                    <div class="checkpoint" [class.active]="item.status === 'Recibido'">
                      Recibido
                    </div>
                  </div>
                </div>

                <!-- Botones de Cambio de Estado -->
                <div>
                  <button (click)="changeStatus(item.id, 'Pagado')">Marcar como Pagado</button>
                  <button (click)="changeStatus(item.id, 'Enviado')">Marcar como Enviado</button>
                  <button (click)="changeStatus(item.id, 'Recibido')">Marcar como Recibido</button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    } @else {
      <p>No hay productos en el carrito.</p>
    }
  </div>

  <!-- Resumen de Compra -->
  <div class="summary-container">
    <h2 class="summary-title">Resumen de Compra</h2>
    @if (isCartEmpty()) {
      <p>No hay productos en el carrito.</p>
    } @else {
      <div class="summary-item">
        <span>Subtotal:</span>
        <span>{{ calculateSubtotal() }} ‚Ç¨</span>
      </div>
      <div class="summary-item">
        <span>Env√≠o:</span>
        <span>{{ calculateShipping() }} ‚Ç¨</span>
      </div>
      <div class="summary-total">
        <span>Total a Pagar:</span>
        <span>{{ calculateTotal() }} ‚Ç¨</span>
      </div>
    }
  </div>
</div>